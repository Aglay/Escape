/**
 * @version		$Id$
 * @author		Nils Asmussen <nils@script-solution.de>
 * @copyright	2008 Nils Asmussen
 */

#include <common.h>
#include "keyboard.h"

static u8 scanCode2KeyCode[][128] = {
	/* simple */
	{
		/* 00 */	0,
		/* 01 */	0,
		/* 02 */	VK_1,
		/* 03 */	VK_2,
		/* 04 */	VK_3,
		/* 05 */	VK_4,
		/* 06 */	VK_5,
		/* 07 */	VK_6,
		/* 08 */	VK_7,
		/* 09 */	VK_8,
		/* 0A */	VK_9,
		/* 0B */	VK_0,
		/* 0C */	VK_MINUS,
		/* 0D */	VK_EQ,
		/* 0E */	VK_BACKSP,
		/* 0F */	VK_TAB,
		/* 10 */	VK_Q,
		/* 11 */	VK_W,
		/* 12 */	VK_E,
		/* 13 */	VK_R,
		/* 14 */	VK_T,
		/* 15 */	VK_Y,
		/* 16 */	VK_U,
		/* 17 */	VK_I,
		/* 18 */	VK_O,
		/* 19 */	VK_P,
		/* 1A */	VK_LBRACKET,
		/* 1B */	VK_RBRACKET,
		/* 1C */	VK_ENTER,
		/* 1D */	VK_LCTRL,
		/* 1E */	VK_A,
		/* 1F */	VK_S,
		/* 20 */	VK_D,
		/* 21 */	VK_F,
		/* 22 */	VK_G,
		/* 23 */	VK_H,
		/* 24 */	VK_J,
		/* 25 */	VK_K,
		/* 26 */	VK_L,
		/* 27 */	VK_SEM,
		/* 28 */	VK_APOS,
		/* 29 */	VK_ACCENT,
		/* 2A */	VK_LSHIFT,
		/* 2B */	VK_BACKSLASH,
		/* 2C */	VK_Z,
		/* 2D */	VK_X,
		/* 2E */	VK_C,
		/* 2F */	VK_V,
		/* 30 */	VK_B,
		/* 31 */	VK_N,
		/* 32 */	VK_M,
		/* 33 */	VK_COMMA,
		/* 34 */	VK_DOT,
		/* 35 */	VK_SLASH,
		/* 36 */	VK_RSHIFT,
		/* 37 */	VK_KPMUL,
		/* 38 */	VK_LALT,
		/* 39 */	VK_SPACE,
		/* 3A */	VK_CAPS,
		/* 3B */	VK_F1,
		/* 3C */	VK_F2,
		/* 3D */	VK_F3,
		/* 3E */	VK_F4,
		/* 3F */	VK_F5,
		/* 40 */	VK_F6,
		/* 41 */	VK_F7,
		/* 42 */	VK_F8,
		/* 43 */	VK_F9,
		/* 44 */	VK_F10,
		/* 45 */	VK_NUM,
		/* 46 */	VK_SCROLL,
		/* 47 */	VK_KP7,
		/* 48 */	VK_KP8,
		/* 49 */	VK_KP9,
		/* 4A */	VK_KPSUB,
		/* 4B */	VK_KP4,
		/* 4C */	VK_KP5,
		/* 4D */	VK_KP6,
		/* 4E */	VK_KPADD,
		/* 4F */	VK_KP1,
		/* 50 */	VK_KP2,
		/* 51 */	VK_KP3,
		/* 52 */	VK_KP0,
		/* 53 */	VK_KPDOT,
		/* 54 */	0,
		/* 55 */	0,
		/* 56 */	0,
		/* 57 */	VK_F11,
		/* 58 */	VK_F12,
		/* 59 */	0,
		/* 5A */	0,
		/* 5B */	0,
		/* 5C */	0,
		/* 5D */	0,
		/* 5E */	0,
		/* 5F */	0,
		/* 60 */	0,
		/* 61 */	0,
		/* 62 */	0,
		/* 63 */	0,
		/* 64 */	0,
		/* 65 */	0,
		/* 66 */	0,
		/* 67 */	0,
		/* 68 */	0,
		/* 69 */	0,
		/* 6A */	0,
		/* 6B */	0,
		/* 6C */	0,
		/* 6D */	0,
		/* 6E */	0,
		/* 6F */	0,
		/* 70 */	0,
		/* 71 */	0,
		/* 72 */	0,
		/* 73 */	0,
		/* 74 */	0,
		/* 75 */	0,
		/* 76 */	0,
		/* 77 */	0,
		/* 78 */	0,
		/* 79 */	0,
		/* 7A */	0,
		/* 7B */	0,
		/* 7C */	0,
		/* 7D */	0,
		/* 7E */	0,
		/* 7F */	0
	},

	/* extended */
	{
		/* 00 */	0,
		/* 01 */	0,
		/* 02 */	0,
		/* 03 */	0,
		/* 04 */	0,
		/* 05 */	0,
		/* 06 */	0,
		/* 07 */	0,
		/* 08 */	0,
		/* 09 */	0,
		/* 0A */	0,
		/* 0B */	0,
		/* 0C */	0,
		/* 0D */	0,
		/* 0E */	0,
		/* 0F */	0,
		/* 10 */	0,
		/* 11 */	0,
		/* 12 */	0,
		/* 13 */	0,
		/* 14 */	0,
		/* 15 */	0,
		/* 16 */	0,
		/* 17 */	0,
		/* 18 */	0,
		/* 19 */	0,
		/* 1A */	0,
		/* 1B */	0,
		/* 1C */	VK_KPENTER,
		/* 1D */	VK_RCTRL,
		/* 1E */	0,
		/* 1F */	0,
		/* 20 */	0,
		/* 21 */	0,
		/* 22 */	0,
		/* 23 */	0,
		/* 24 */	0,
		/* 25 */	0,
		/* 26 */	0,
		/* 27 */	0,
		/* 28 */	0,
		/* 29 */	0,
		/* 2A */	0,
		/* 2B */	0,
		/* 2C */	0,
		/* 2D */	0,
		/* 2E */	0,
		/* 2F */	0,
		/* 30 */	0,
		/* 31 */	0,
		/* 32 */	0,
		/* 33 */	0,
		/* 34 */	0,
		/* 35 */	VK_KPDIV,
		/* 36 */	0,
		/* 37 */	0,
		/* 38 */	VK_RALT,
		/* 39 */	0,
		/* 3A */	0,
		/* 3B */	0,
		/* 3C */	0,
		/* 3D */	0,
		/* 3E */	0,
		/* 3F */	0,
		/* 40 */	0,
		/* 41 */	0,
		/* 42 */	0,
		/* 43 */	0,
		/* 44 */	0,
		/* 45 */	0,
		/* 46 */	0,
		/* 47 */	VK_HOME,
		/* 48 */	VK_UP,
		/* 49 */	VK_PGUP,
		/* 4A */	0,
		/* 4B */	VK_LEFT,
		/* 4C */	0,
		/* 4D */	VK_DOWN,
		/* 4E */	0,
		/* 4F */	VK_END,
		/* 50 */	VK_RIGHT,
		/* 51 */	VK_PGDOWN,
		/* 52 */	VK_INSERT,
		/* 53 */	VK_DELETE,
		/* 54 */	0,
		/* 55 */	0,
		/* 56 */	0,
		/* 57 */	0,
		/* 58 */	0,
		/* 59 */	0,
		/* 5A */	0,
		/* 5B */	VK_LSUPER,
		/* 5C */	VK_RSUPER,
		/* 5D */	VK_APPS,
		/* 5E */	0,
		/* 5F */	0,
		/* 60 */	0,
		/* 61 */	0,
		/* 62 */	0,
		/* 63 */	0,
		/* 64 */	0,
		/* 65 */	0,
		/* 66 */	0,
		/* 67 */	0,
		/* 68 */	0,
		/* 69 */	0,
		/* 6A */	0,
		/* 6B */	0,
		/* 6C */	0,
		/* 6D */	0,
		/* 6E */	0,
		/* 6F */	0,
		/* 70 */	0,
		/* 71 */	0,
		/* 72 */	0,
		/* 73 */	0,
		/* 74 */	0,
		/* 75 */	0,
		/* 76 */	0,
		/* 77 */	0,
		/* 78 */	0,
		/* 79 */	0,
		/* 7A */	0,
		/* 7B */	0,
		/* 7C */	0,
		/* 7D */	0,
		/* 7E */	0,
		/* 7F */	0
	}
};

static u8 lastScanCode = 0;
static u8 set = 0;

u8 kb_set1_getKeycode(u8 scanCode) {
	/* break? */
	if(scanCode & 0x80) {
		return 0;
	}
	else {
		/* extended code-start? */
		if(scanCode == 0xE0) {
			set = 1;
			return 0;
		}

		lastScanCode = scanCode2KeyCode[set][scanCode & 0x7F];
		set = 0;
		return lastScanCode;
	}
}
