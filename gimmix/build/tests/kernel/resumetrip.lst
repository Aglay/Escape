                   # 1 "kernel/resumetrip.mms"
                   # 1 "<built-in>"
                   # 1 "<command-line>"
                   # 1 "kernel/resumetrip.mms"
                   %
                   % resumetrip.mms -- test trips triggered by RESUME in kernel-mode
                   %
                   
                     % segmentsizes: 1,0,0,0; pageSize=2^13; r=0x4000; n=0, f=0
 ...000: 10000d00  RV OCTA #10000D0000004000
 ...004: 00004000
                   
                     LOC #00004000
0000000000004000:    OCTA #0000000000000007 % PTE 0 (#0000000000000000 .. #0000000000001FFF)
 ...000: 00000000
 ...004: 00000007
 ...008: 00000000    OCTA #0000000000002007 % PTE 1 (#0000000000002000 .. #0000000000003FFF)
 ...00c: 00002007
                   
                   
                     LOC #10
                     % #10 (div by zero)
0000000000000010:    ADD $5,$5,1
 ...010: 21050501
 ...014: f60400ff    PUT rJ,$255
 ...018: feff0000    GET $255,rB
 ...01c: f9000000    RESUME 0
                   
                   
                     LOC #500000
                     % forced trap address for RESUME AGAIN
0000000000500000:  RESAG SETH $128,#0000
 ...000: e0800000
 ...004: ea801d00    ORML $128,#1D00
 ...008: eb800000    ORL $128,#0000
 ...00c: f61d0080    PUT rXX,$128 % DIVI $0,$0,0
 ...010: e1ff00ff    SETMH $255,#00FF
 ...014: f9000001    RESUME 1
                   
                     % forced trap address for the TRAP of RESUME CONTINUE
 ...018: 21050501  DUMMY ADD $5,$5,1
 ...01c: e0008000    SETH $0,#8000
 ...020: e9000000    ORMH $0,RESAG>>32
 ...024: ea000050    ORML $0,RESAG>>16
******************   ORL $0,RESAG>>0
************ warning: YZ field doesn't fit in two bytes
 ...028: eb000000
 ...02c: f60d0000    PUT rT,$0
 ...030: e1ff00ff    SETMH $255,#00FF
 ...034: f9000001    RESUME 1
                   
                     % forced trap address for RESUME CONTINUE
 ...038: e0008000  RESCON SETH $0,#8000
 ...03c: e9000000    ORMH $0,DUMMY>>32
 ...040: ea000050    ORML $0,DUMMY>>16
******************   ORL $0,DUMMY>>0
************ warning: YZ field doesn't fit in two bytes
 ...044: eb000018
 ...048: f60d0000    PUT rT,$0
 ...04c: e0800100    SETH $128,#0100
 ...050: eb800001    ORL $128,#0001
 ...054: f61d0080    PUT rXX,$128 % TRAP 0,0,1
 ...058: e1ff00ff    SETMH $255,#00FF
 ...05c: f9000001    RESUME 1
                   
                     % forced trap address for RESUME SET
 ...060: e0008000  RESSET SETH $0,#8000
 ...064: e9000000    ORMH $0,RESCON>>32
 ...068: ea000050    ORML $0,RESCON>>16
******************   ORL $0,RESCON>>0
************ warning: YZ field doesn't fit in two bytes
 ...06c: eb000038
 ...070: f60d0000    PUT rT,$0
 ...074: e0800200    SETH $128,#0200
 ...078: e9808000    ORMH $128,#8000
 ...07c: ea800004    ORML $128,#0004
 ...080: f61d0080    PUT rXX,$128
 ...084: e3809988    SETL $128,#9988
 ...088: f61f0080    PUT rZZ,$128 % SET $4,#9988
 ...08c: e1ff00ff    SETMH $255,#00FF
 ...090: f9000001    RESUME 1
                   
                   
                     LOC #1000
                     % setup rT
0000000000001000:  Main SETH $0,#8000
 ...000: e0008000
 ...004: e9000000    ORMH $0,RESSET>>32
 ...008: ea000050    ORML $0,RESSET>>16
******************   ORL $0,RESSET>>0
************ warning: YZ field doesn't fit in two bytes
 ...00c: eb000060
 ...010: f60d0000    PUT rT,$0
                   
                     % setup rV
 ...014: e0008000    SETH $0,#8000
 ...018: e9000000    ORMH $0,RV>>32
 ...01c: ea000000    ORML $0,RV>>16
 ...020: eb000000    ORL $0,RV
 ...024: 8f000000    LDOU $0,$0,0
 ...028: f6120000    PUT rV,$0
                   
 ...02c: e300ff00    SETL $0,#FF00
 ...030: f6150000    PUT rA,$0
 ...034: f7130080    PUT rG,128
                   
                     % now go to user-mode (we are at #8000000000001000 atm)
 ...038: e3002000    SET $0,#2000
 ...03c: f61c0000    PUT rWW,$0
 ...040: e0008000    SETH $0,#8000
 ...044: f61d0000    PUT rXX,$0
 ...048: e1ff00ff    SETMH $255,#00FF % have to be set in usermode
 ...04c: f9000001    RESUME 1
                   
                   
                     LOC #2000
0000000000002000:    SET $5,0
 ...000: e3050000
                   
                     % test RESUME SET
 ...004: 00010203    TRAP 1,2,3
 ...008: fe060015    GET $6,rA
                   
                     % test RESUME CONTINUE (with TRAP)
 ...00c: 00010203    TRAP 1,2,3
 ...010: fe070015    GET $7,rA
                   
                     % test RESUME AGAIN
 ...014: 00010203    TRAP 1,2,3
 ...018: fe080015    GET $8,rA
                   
 ...01c: 00000000    TRAP 0

Symbol table:
 DUMMY = #0000000000500018 (4)
 Main = #0000000000001000 (1)
 RESAG = #0000000000500000 (3)
 RESCON = #0000000000500038 (5)
 RESSET = #0000000000500060 (6)
 RV = #0000000000000000 (2)
